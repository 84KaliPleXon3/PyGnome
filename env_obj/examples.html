

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Customizing environment objects &mdash; pyGNOME 0.5.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="pyGNOME 0.5.0 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> pyGNOME
          

          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure.html">GNOME Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripting.html">Scripting pygnome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customizing.html">Customizing pygnome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">The logging system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serialization.html">Notes on serialization / deserialization:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units used in GNOME / PyGNOME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">PyGnome Class Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyGNOME</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Customizing environment objects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/env_obj/examples.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="toctree-wrapper compound">
</div>
<p>Below is a simple staggered grid example that we will be working with.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">gnome.environment</span> <span class="kn">import</span> <span class="n">GridCurrent</span>
<span class="kn">import</span> <span class="nn">pprint</span> <span class="kn">as</span> <span class="nn">pp</span>

<span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;staggered_sine_channel.nc&#39;</span>
<span class="n">gc</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
<span class="n">gc2</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;u_psi&#39;</span><span class="p">,</span> <span class="s1">&#39;v_psi&#39;</span><span class="p">])</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">grid</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">g</span><span class="o">.</span><span class="n">draw_to_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;node&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">}})</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/env_obj_examples_2_0.png" src="../_images/env_obj_examples_2_0.png" />
</div>
</div>
<div class="section" id="Customizing-environment-objects">
<h1>Customizing environment objects<a class="headerlink" href="#Customizing-environment-objects" title="Permalink to this headline">¶</a></h1>
<p>Environment objects are complicated entities that combine many functions
in a configurable framework. There are many different levels of
complexity available to the user, and often several ways to accomplish
the same goal. This section is intended to detail these options so the
user can maximize their effectiveness with the system.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">gc</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="s1">&#39;staggered_sine_channel.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This is the simplest way to create an environment object, but also
requires the most standardized data. The grid, variables, time, and
depth must all be able to be created using their respective
&#8216;from_netCDF&#8217; functions using the default grid variable names, default
variable names, etc. Generally, for environment objects the data
defaults are located on the object itself:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gnome.environment</span> <span class="kn">import</span> <span class="n">GridTemperature</span>
<span class="k">print</span> <span class="n">GridTemperature</span><span class="o">.</span><span class="n">default_names</span>
<span class="k">print</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">default_names</span>
<span class="k">print</span> <span class="n">gc</span><span class="o">.</span><span class="n">varnames</span>
<span class="k">print</span> <span class="n">gc</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">varname</span>
<span class="k">print</span> <span class="n">gc</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">varname</span>
<span class="k">print</span> <span class="n">gc</span><span class="o">.</span><span class="n">u</span> <span class="ow">is</span> <span class="n">gc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;water_t&#39;, &#39;temp&#39;]
{&#39;u&#39;: [&#39;u&#39;, &#39;U&#39;, &#39;water_u&#39;, &#39;curr_ucmp&#39;], &#39;w&#39;: [&#39;w&#39;, &#39;W&#39;], &#39;v&#39;: [&#39;v&#39;, &#39;V&#39;, &#39;water_v&#39;, &#39;curr_vcmp&#39;]}
[&#39;u&#39;, &#39;v&#39;, &#39;constant w&#39;]
u
v
True
</pre></div></div>
</div>
<p>As we can see, the variables &#8216;u&#8217; and &#8216;v&#8217; were located and used to
construct the object. &#8216;w&#8217; was not found, however, and was replaced with
a constant 0 instead.</p>
<p>There are three current velocities in this file, all on different grids.
there is the [&#8216;u&#8217;, &#8216;v&#8217;] pair, which are on separate staggered grids, the
[&#8216;u_psi&#8217;, &#8216;v_psi&#8217;] pair on the nodes grid, and [&#8216;u_rho&#8217;, &#8216;v_rho&#8217;]
pair on the center grid. In order to specify one of the other pairs, we
do the following:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">gc</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;u_psi&#39;</span><span class="p">,</span> <span class="s1">&#39;v_psi&#39;</span><span class="p">])</span>
<span class="k">print</span> <span class="n">gc</span><span class="o">.</span><span class="n">varnames</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;u_psi&#39;, &#39;v_psi&#39;, &#39;constant w&#39;]
</pre></div></div>
</div>
<p>Using the &#8216;varnames&#8217; keyword, we can specify the variables to be
searched for. For all other components of this GridCurrent, it will
still use the default construction. This is a general trend throughout
the whole system, where there is some reasonable default behavior, and
optional complexity accessed by keyword arguments.</p>
<p>One very important keyword argument is the &#8216;grid_topology&#8217; keyword. The
grid topology describes a relationship between the variables in the
netCDF file and parts of the grid. Unless specified, this grid topology
is generated based on default names and what is located in the file, or
is extracted from an appropriate topology variable within the file
itself. Topology variables that follow the <em>ugrid</em> or <em>sgrid</em> standards
are supported.</p>
<p>Our example file does not have a topology specified, but the names are
detected by the defaults, and so a fully realized staggered grid can be
created from it. However, we can also specify our own grid topology as a
dict:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">grid_topo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;node_lon&#39;</span><span class="p">:</span><span class="s1">&#39;lon_rho&#39;</span><span class="p">,</span>
             <span class="s1">&#39;node_lat&#39;</span><span class="p">:</span><span class="s1">&#39;lat_rho&#39;</span><span class="p">,</span>
             <span class="s1">&#39;center_lon&#39;</span><span class="p">:</span><span class="s1">&#39;lon_psi&#39;</span><span class="p">,</span>
             <span class="s1">&#39;center_lat&#39;</span><span class="p">:</span><span class="s1">&#39;lat_psi&#39;</span><span class="p">}</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                             <span class="n">varnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;u_rho&#39;</span><span class="p">,</span><span class="s1">&#39;v_rho&#39;</span><span class="p">],</span>
                             <span class="n">grid_topology</span> <span class="o">=</span> <span class="n">grid_topo</span><span class="p">)</span>

<span class="n">g2</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">grid</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">g2</span><span class="o">.</span><span class="n">draw_to_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;node&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">}})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/env_obj_examples_11_0.png" src="../_images/env_obj_examples_11_0.png" />
</div>
</div>
<p>As you can see, the center and node grids have been swapped, which is
not the default behavior for these names. Also note however, that the
edge grids, which are present on our original grid object g, are not
present on the new object g2. This is because when using a keyword to
override default behavior, it follows the override explicitly. In order
for these edge grids to appear, they must be declared specifically.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">g</span><span class="o">.</span><span class="n">edge1_lon</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="k">print</span> <span class="n">g2</span><span class="o">.</span><span class="n">edge1_lon</span> <span class="ow">is</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
True
</pre></div></div>
</div>
<p>The full reference for keywords available to the from_netCDF function
are here (inset link here)</p>
</div>
<div class="section" id="Demonstration-of-component-sharing">
<h1>Demonstration of component sharing<a class="headerlink" href="#Demonstration-of-component-sharing" title="Permalink to this headline">¶</a></h1>
<p>A GridCurrent is a vector environment object, so it is composed of other
scalar environment objects</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">gc</span><span class="o">.</span><span class="vm">__class__</span>
<span class="n">pp</span><span class="o">.</span><span class="n">pprint</span> <span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="vm">__class__</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">gc</span><span class="o">.</span><span class="n">variables</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;gnome.environment.environment_objects.GridCurrent&#39;&gt;
[&lt;class &#39;gnome.environment.grid_property.GriddedProp&#39;&gt;,
 &lt;class &#39;gnome.environment.grid_property.GriddedProp&#39;&gt;,
 &lt;class &#39;gnome.environment.ts_property.TimeSeriesProp&#39;&gt;]
</pre></div></div>
</div>
<p>The &#8216;TimeSeriesProp&#8217; object is an environment object that represents the
vertical velocity component. However, since it is a constant 0 in this
simple case, it can be represented with a simpler object.</p>
<p>Lets re-focus on the two GriddedProp objects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">u</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">u</span>
<span class="k">assert</span> <span class="n">gc</span><span class="o">.</span><span class="n">u</span> <span class="ow">is</span> <span class="n">gc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">v</span>
<span class="k">print</span> <span class="n">u</span><span class="o">.</span><span class="n">grid</span>
<span class="k">print</span> <span class="n">u</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="n">v</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="n">gc</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;gnome.environment.grid.PyGrid_S object at 0x000000000490CB38&gt;
True
</pre></div></div>
</div>
<p>As you can see, they are all attached to the same grid instance. This is
also true for time and depth, when applicable. When using the
.from_netCDF() function to construct these environment variables, as we
did above, these associations are automatically made.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="c1">#The points may or may not be on the grid</span>
<span class="n">test_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100000</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span> <span class="o">*</span> <span class="mf">19.0</span>
<span class="n">test_pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="mf">2.0</span>
<span class="n">test_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Below is a demonstration of the performance provided by memoization.
First we will try to compute the same result from the two different
GridCurrent instances. Then, we will alter the time (to reset
memoization) and try again after sharing the grid between the two
GridCurrent instances.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">timeit</span>
gc.at(test_pts, test_time)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The slowest run took 116.71 times longer than the fastest. This could mean that an intermediate result is being cached.
1 loop, best of 3: 4.27 ms per loop
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">timeit</span>
gc2.at(test_pts, test_time)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The slowest run took 37.26 times longer than the fastest. This could mean that an intermediate result is being cached.
100 loops, best of 3: 4.24 ms per loop
</pre></div></div>
</div>
<p>Now, we share the components:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">gc2</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">gc2</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">gc2</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">grid</span>

<span class="n">test_time2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">test_pts</span> <span class="o">+=</span> <span class="mf">0.001</span>
<span class="k">print</span> <span class="n">gc</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="n">gc2</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">timeit</span>
rv1 = gc.at(test_pts, test_time2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The slowest run took 29.48 times longer than the fastest. This could mean that an intermediate result is being cached.
100 loops, best of 3: 4.41 ms per loop
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">timeit</span>
rv2 = gc2.at(test_pts, test_time2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The slowest run took 17.29 times longer than the fastest. This could mean that an intermediate result is being cached.
100 loops, best of 3: 4.39 ms per loop
</pre></div></div>
</div>
<p>This increase in first-call performance is simply from sharing the grid
object between the two GridCurrent instances, and would occur on all
other environment objects that share the grid object (such as a
GridTemperature, GridSalinity, etc). Normally, many more aspects can be
shared, including time, depth, and the underlying Dataset object
representing data on disk. Sharing all of these increases performance,
but grid is the largest contributor.</p>
<p>This is because memoization happens at the grid level results as well as
at the final results computation, therefore doing duplicate queries is
extremely fast:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">timeit</span>
rv2 = gc2.at(test_pts, test_time2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
100 loops, best of 3: 4.38 ms per loop
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012, NOAA Emergecny Response Division.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>