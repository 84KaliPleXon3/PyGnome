

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Property Objects &mdash; pyGNOME 0.5.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="pyGNOME 0.5.0 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> pyGNOME
          

          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure.html">GNOME Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripting.html">Scripting pygnome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customizing.html">Customizing pygnome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">The logging system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serialization.html">Notes on serialization / deserialization:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units used in GNOME / PyGNOME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">PyGnome Class Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyGNOME</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Property Objects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scripting/property_objects.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="property-objects">
<h1>Property Objects<a class="headerlink" href="#property-objects" title="Permalink to this headline">¶</a></h1>
<p>Property objects are designed to represent a natural phenomenon and provide an interface that can be queried in time and space. These objects
can represent a space-independent time series or gridded, time dependent data. They can also represent scalar and (2D) vector phenomena.
They are the core means for representing natural phenomena in the latest versions of PyGNOME.</p>
<p>Examples of things that Property objects can represent include: temperature, water velocity, wind speed &amp; direction time series, etc.</p>
<p>For documentation of the API see <a class="reference internal" href="../reference.html#module-gnome.environment.property" title="gnome.environment.property"><code class="xref py py-mod docutils literal"><span class="pre">gnome.environment.property</span></code></a>
For documentation of implemented Properties, see <code class="xref py py-mod docutils literal"><span class="pre">gnome.environment.property_classes</span></code></p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>The environmental models in GNOME are often driven with data created by other models, such as ROMS, HYCOM, etc. In the past, the output from
these models were processed by renaming and regridding to conform to GNOME&#8217;s expectations before use.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Create GridCurrent from a netCDF file.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc4</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">gnome.environment.property_classes</span> <span class="k">import</span> <span class="n">GridCurrent</span>

<span class="n">fn</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;my_current_file.nc&#39;</span><span class="p">)</span>
<span class="n">current</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
<p>Create GridCurrent from a netCDF file, and specify grid topology.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">current</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                                  <span class="n">grid_topology</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;node_lon&#39;</span><span class="p">:</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;node_lat&#39;</span><span class="p">:</span><span class="s1">&#39;lat&#39;</span><span class="p">}</span>
                                  <span class="p">)</span>
</pre></div>
</div>
<p>Again, this time specifying variable names as well.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">current</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                                  <span class="n">grid_topology</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;node_lon&#39;</span><span class="p">:</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;node_lat&#39;</span><span class="p">:</span><span class="s1">&#39;lat&#39;</span><span class="p">},</span>
                                  <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;water_u&#39;</span><span class="p">,</span> <span class="s1">&#39;water_v&#39;</span><span class="p">]</span>
                                  <span class="p">)</span>
</pre></div>
</div>
<p>One major advantage to Property objects is re-use of common attributes. For example, in a data file you have a grid, and
wind and current variables that are associated with the grid.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">current</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fn</span><span class="p">)</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">GridWind</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fn</span><span class="p">,</span>
                            <span class="n">grid</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, the current and wind now both share the same grid object, which has numerous performance benefits. This is
one of the most common cases of sharing between Property objects.</p>
<p>You can create a Property out of an already open dataset as well. This may help alleviate &#8216;too many files&#8217; problems when working
with large numbers of files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">current</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also set up a Property object from scratch, which can be very useful when mocking up a situation. The following code creates
a GridCurrent representing circular currents around the origin.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#create the rectangular grid</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">61</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">61</span><span class="n">j</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">SGrid</span><span class="p">(</span><span class="n">node_lon</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
          <span class="n">node_lat</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">build_celltree</span><span class="p">()</span>

<span class="c1">#using a single time implies extrapolation</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#create the data associated with each grid vertex</span>
<span class="n">angs</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angs</span><span class="p">)</span> <span class="o">*</span> <span class="n">mag</span>
<span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angs</span><span class="p">)</span> <span class="o">*</span> <span class="n">mag</span>
<span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span> <span class="o">*</span> <span class="mi">20</span>
<span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span> <span class="o">*</span> <span class="mi">20</span>

<span class="c1">#Create Property objects for the components separately, then combine into a GridCurrent</span>
<span class="n">vels_x</span> <span class="o">=</span> <span class="n">GriddedProp</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v_x&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">vx</span><span class="p">)</span>
<span class="n">vels_y</span> <span class="o">=</span> <span class="n">GriddedProp</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v_y&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">vy</span><span class="p">)</span>
<span class="n">vg</span> <span class="o">=</span> <span class="n">GridCurrent</span><span class="p">(</span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">vels_y</span><span class="p">,</span> <span class="n">vels_x</span><span class="p">],</span> <span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-a-new-property">
<h2>Defining a new Property<a class="headerlink" href="#defining-a-new-property" title="Permalink to this headline">¶</a></h2>
<p>To create a new Property, let us take the example of water temperature.</p>
<ol class="arabic simple">
<li>It is scalar, so it would inherit from a scalar-type Property</li>
<li>In this example, it is gridded. So our base class is a GriddedProp.</li>
<li>We have a number of data files where the default names could be &#8216;water_t&#8217; or &#8216;temp&#8217;, and we want to write them in to be auto-detected.</li>
</ol>
<p>Here is the class definition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterTemperature</span><span class="p">(</span><span class="n">GriddedProp</span><span class="p">):</span>
    <span class="n">default_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;water_t&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>That&#8217;s it! Now, you can do the following in your scripts:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gnome.environment.property_classes</span> <span class="k">import</span> <span class="n">WaterTemperature</span>

<span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50.3</span><span class="p">,</span> <span class="mf">40.2</span><span class="p">]</span>
<span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;my_datafile.nc&#39;</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">WaterTemperature</span><span class="o">.</span><span class="n">from_netCDF</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
<span class="n">first_temp_at_point</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min_time</span><span class="p">)</span>
</pre></div>
</div>
<p>Lets do a more advanced example. We want to do another WaterTemperature object, but we want to
force only a single depth, even if our data has multiple layers. If a user asks for the temperature
at a point anywhere in the water column, it will only give the value at the surface (or bottom). This
is not very useful except as a demonstration.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterTemperature</span><span class="p">(</span><span class="n">GriddedProp</span><span class="p">):</span>
    <span class="n">default_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;water_t&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">extrapolate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">GriddedProp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="n">extrapolate</span><span class="p">)</span>
</pre></div>
</div>
<p>The point is if a property subclass needs to implement some special logic, it can be accomplished by simply overriding the function and writing it in.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012, NOAA Emergecny Response Division.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>